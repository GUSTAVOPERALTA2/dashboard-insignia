<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vicebot Dashboard</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <!-- Header con layout reorganizado -->
    <header class="header">
      <div class="header-left">
        <h1>
          Incidencias
          <span id="connection-indicator" class="connection-status"></span>
        </h1>
        <span id="userName" class="user-welcome"></span>
      </div>
      
      <div class="header-right">
        <div class="header-buttons">
          <button id="btnReports" class="btn btn-secondary">üìä Reportes</button>
          <button id="btnNewIncident" class="btn btn-success">+ Nueva Incidencia</button>
          <button id="btnRefresh" class="btn-reload" title="Actualizar"></button>
          <button onclick="logout()" class="btn-power" title="Cerrar Sesi√≥n"></button>
        </div>
        <span class="sync-info">√öltima sync: <span id="lastSync">‚Äî</span></span>
      </div>
    </header>

    <!-- Filtros -->
    <section class="filters">
      <div class="filter-row">
        <input type="text" id="qInput" class="form-input" placeholder="Buscar por folio, lugar, descripci√≥n...">
        
        <select id="areaSel" class="form-select">
          <option value="">Todas las √°reas</option>
          <option value="man">MAN</option>
          <option value="it">IT</option>
          <option value="ama">AMA</option>
          <option value="rs">RS</option>
          <option value="seg">SEG</option>
        </select>
        
        <select id="limitSel" class="form-select">
          <option value="25">25</option>
          <option value="50" selected>50</option>
          <option value="100">100</option>
        </select>
      </div>
      
      <div class="chips">
        <button class="chip is-active" data-status="">Todos</button>
        <button class="chip" data-status="open">Abiertos</button>
        <button class="chip" data-status="in_progress">En Progreso</button>
        <button class="chip" data-status="done">Completados</button>
        <button class="chip" data-status="canceled">Cancelados</button>
      </div>
    </section>

    <!-- Tabla -->
    <section class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>Folio</th>
            <th>Fecha</th>
            <th>Estado</th>
            <th>√Årea</th>
            <th>Ubicaci√≥n</th>
            <th>Descripci√≥n</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
      
      <div id="emptyBox" class="empty-box hidden">No hay incidencias</div>
    </section>

    <!-- Paginaci√≥n -->
    <section class="pager">
      <button id="btnPrev" class="btn" disabled>‚Üê Anterior</button>
      <span id="rangeLbl" class="range-label">‚Äî</span>
      <button id="btnNext" class="btn" disabled>Siguiente ‚Üí</button>
    </section>
  </div>

  <!-- Modal de detalle -->
  <div id="detailOverlay" class="overlay hidden">
    <div class="modal">
      <button id="btnClose" class="btn-close">‚úï</button>
      <div id="detailPanel" class="detail-content"></div>
    </div>
  </div>

  <!-- Modal de nueva incidencia -->
  <div id="newIncidentOverlay" class="overlay hidden">
    <div class="modal modal-form">
      <button id="btnCloseNew" class="btn-close">‚úï</button>
      <div class="modal-header">
        <h2>üìù Nueva Incidencia</h2>
      </div>
      <form id="newIncidentForm" class="incident-form">
        <div class="form-group">
          <label for="newDescription">Descripci√≥n <span class="required">*</span></label>
          <textarea 
            id="newDescription" 
            name="descripcion" 
            rows="4" 
            placeholder="Describe el problema o solicitud..."
            required
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="newArea">√Årea Destino <span class="required">*</span></label>
            <select id="newArea" name="area_destino" required>
              <option value="">Selecciona un √°rea</option>
              <option value="IT">IT</option>
              <option value="MAN">Mantenimiento</option>
              <option value="AMA">AMA de Llaves</option>
              <option value="RS">Room Service</option>
              <option value="SEG">Seguridad</option>
              <option value="EXP">Experiencias</option>
            </select>
          </div>

          <div class="form-group">
            <label for="newLocation">Ubicaci√≥n <span class="required">*</span></label>
            <input 
              type="text" 
              id="newLocation" 
              name="lugar" 
              placeholder="Ej: Habitaci√≥n 3304, Lobby, Sistemas..."
              required
            />
          </div>
        </div>

        <div class="form-group">
          <label for="newRequester">Emisor/Solicitante <span class="required">*</span></label>
          <select id="newRequester" name="chat_id" required>
            <option value="">Selecciona un usuario</option>
          </select>
        </div>

        <div class="form-group">
          <label for="newAttachments">Adjuntos (opcional)</label>
          <input 
            type="file" 
            id="newAttachments" 
            name="attachments" 
            multiple 
            accept="image/*,video/*,.pdf"
          />
          <small class="help-text">Puedes subir im√°genes, videos o PDFs</small>
        </div>

        <div class="form-actions">
          <button type="button" id="btnCancelNew" class="btn btn-secondary">Cancelar</button>
          <button type="submit" id="btnSubmitNew" class="btn btn-success">Crear Incidencia</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de reportes -->
  <div id="reportsOverlay" class="overlay hidden">
    <div class="modal modal-reports">
      <button id="btnCloseReports" class="btn-close">‚úï</button>
      
      <div class="modal-header">
        <h2>üìä Generar Reporte de Incidencias</h2>
      </div>
      
      <div class="report-form">
        <div class="form-section">
          <h3>Rango de Fechas</h3>
          <div class="date-inputs">
            <input type="date" id="reportStartDate" class="form-input">
            <span>hasta</span>
            <input type="date" id="reportEndDate" class="form-input">
          </div>
        </div>

        <div class="form-section">
          <h3>√Åreas</h3>
          <div class="checkbox-group">
            <label>
              <input type="checkbox" value="man" checked>
              <span>Mantenimiento</span>
            </label>
            <label>
              <input type="checkbox" value="it" checked>
              <span>IT</span>
            </label>
            <label>
              <input type="checkbox" value="ama" checked>
              <span>AMA</span>
            </label>
            <label>
              <input type="checkbox" value="rs" checked>
              <span>Room Service</span>
            </label>
            <label>
              <input type="checkbox" value="seg" checked>
              <span>Seguridad</span>
            </label>
            <label>
              <input type="checkbox" value="exp" checked>
              <span>Experiencias</span>
            </label>
          </div>
        </div>

        <div class="form-section">
          <h3>Estados</h3>
          <div class="checkbox-group">
            <label>
              <input type="checkbox" value="open" checked>
              <span>Abiertos</span>
            </label>
            <label>
              <input type="checkbox" value="in_progress" checked>
              <span>En Progreso</span>
            </label>
            <label>
              <input type="checkbox" value="done" checked>
              <span>Completados</span>
            </label>
            <label>
              <input type="checkbox" value="canceled" checked>
              <span>Cancelados</span>
            </label>
          </div>
        </div>

        <div class="report-actions">
          <button id="btnPreviewReport" class="btn btn-secondary">üëÅ Vista Previa</button>
          <button id="btnGenerateReport" class="btn btn-primary">üìä Generar y Descargar</button>
        </div>

        <div id="reportsPreview" class="hidden">
          <h3>Vista Previa</h3>
          <div id="reportsStats" class="stats-grid"></div>
          <div class="preview-table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>Folio</th>
                  <th>Fecha</th>
                  <th>Estado</th>
                  <th>√Årea</th>
                  <th>Ubicaci√≥n</th>
                  <th>Descripci√≥n</th>
                </tr>
              </thead>
              <tbody id="reportsPreviewBody"></tbody>
            </table>
          </div>
        </div>

        <div id="reportGenerating" class="hidden report-status">
          <div class="spinner"></div>
          <p>‚è≥ Generando reporte...</p>
        </div>

        <div id="reportSuccess" class="hidden report-status">
          <p>‚úÖ Reporte generado y descargado exitosamente</p>
        </div>
      </div>
    </div>
  </div>
  
  <script src="connection-indicator.js"></script>
  <script src="app.js"></script>
</body>
</html>